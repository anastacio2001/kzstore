// ============================================
// KZSTORE - Prisma Schema para PostgreSQL (Neon)
// Migrado do MySQL Cloud SQL
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// 1Ô∏è‚É£ PRODUCTS (Produtos)
// ============================================
model Product {
  id                String    @id @default(uuid())
  nome              String    @db.VarChar(255)
  descricao         String?   @db.Text
  categoria         String    @db.VarChar(100)
  subcategoria      String?   @db.VarChar(100)
  condicao          String?   @db.VarChar(50) // 'Novo', 'Usado', 'Refurbished'
  
  // Pre√ßos
  preco_aoa         Decimal   @db.Decimal(12, 2)
  preco_usd         Decimal?  @db.Decimal(12, 2)
  custo_aoa         Decimal?  @db.Decimal(12, 2)
  margem_lucro      Decimal?  @db.Decimal(5, 2)
  
  // Estoque
  estoque           Int       @default(0)
  estoque_minimo    Int       @default(5)
  
  // Imagens e M√≠dia
  imagem_url        String?   @db.VarChar(500)
  imagens           Json?     // Array de URLs
  
  // Detalhes do Produto
  especificacoes    Json?     // Especifica√ß√µes t√©cnicas
  marca             String?   @db.VarChar(100)
  modelo            String?   @db.VarChar(100)
  sku               String?   @unique @db.VarChar(100)
  codigo_barras     String?   @db.VarChar(100)
  
  // Dimens√µes e Peso
  peso_kg           Decimal?  @db.Decimal(8, 2)
  dimensoes         Json?     // {largura, altura, profundidade}
  
  // Status e Configura√ß√µes
  ativo             Boolean   @default(true)
  destaque          Boolean   @default(false)
  is_featured       Boolean   @default(false)
  featured_order    Int?
  is_pre_order      Boolean   @default(false)
  pre_order_info    Json?     // {estimated_arrival, deposit_percentage, max_quantity}
  
  // Fornecedor
  fornecedor        String?   @db.VarChar(200)
  
  // Frete Personalizado Avan√ßado
  shipping_type     String?   @default("paid") @db.VarChar(30) // 'free_all', 'free_luanda', 'paid_fixed', 'dynamic'
  shipping_cost_aoa Decimal?  @default(0) @db.Decimal(10, 2)
  shipping_cost_usd Decimal?  @default(0) @db.Decimal(10, 2)
  free_shipping_provinces Json? // Array de prov√≠ncias com frete gr√°tis, ex: ["Luanda", "Bengo"]
  
  // Tags e Categorias
  tags              Json?     // Array de tags
  category_id       String?   @db.VarChar(50)
  subcategory_id    String?   @db.VarChar(50)
  
  // Estat√≠sticas e Avalia√ß√µes
  total_vendas      Int       @default(0)
  rating_medio      Decimal?  @db.Decimal(3, 2)
  total_avaliacoes  Int       @default(0)
  
  // Timestamps
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  
  // Rela√ß√µes
  reviews           Review[]
  flashSales        FlashSale[]
  priceAlerts       PriceAlert[]
  preOrders         PreOrder[]
  stockHistory      StockHistory[]
  favorites         Favorite[]
  affiliateClicks   AffiliateClick[]
  
  @@index([categoria])
  @@index([marca])
  @@index([ativo])
  @@index([destaque])
  @@index([estoque])
  @@map("products")
}

// ============================================
// üåü FAVORITES (Favoritos/Wishlist)
// ============================================
model Favorite {
  id          String   @id @default(uuid())
  user_id     String   @db.VarChar(100)
  product_id  String   @db.VarChar(100)
  created_at  DateTime @default(now())
  
  // Rela√ß√£o
  product     Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  @@unique([user_id, product_id])
  @@index([user_id])
  @@index([product_id])
  @@map("favorites")
}

// ============================================
// 2Ô∏è‚É£ ORDERS (Pedidos)
// ============================================
model Order {
  id                String    @id @default(uuid())
  order_number      String    @unique @db.VarChar(50)
  
  // Informa√ß√µes do Cliente
  user_id           String?   @db.VarChar(100)
  user_name         String    @db.VarChar(200)
  user_email        String    @db.VarChar(200)
  
  // Itens do Pedido (JSON array)
  items             Json      // OrderItem[]
  
  // Valores
  subtotal          Decimal   @db.Decimal(12, 2)
  tax_amount        Decimal?  @db.Decimal(12, 2)
  discount_amount   Decimal?  @db.Decimal(12, 2)
  discount_type     String?   @db.VarChar(50)
  discount_details  String?   @db.Text
  shipping_cost     Decimal   @db.Decimal(12, 2)
  total             Decimal   @db.Decimal(12, 2)
  
  // Pagamento
  payment_method    String    @db.VarChar(100)
  payment_status    String    @db.VarChar(50) @default("pending")
  
  // Endere√ßo de Entrega (JSON)
  shipping_address  Json
  
  // Status e Rastreamento
  status            String    @db.VarChar(50) @default("pending")
  tracking_number   String?   @db.VarChar(100)
  notes             String?   @db.Text
  
  // Timestamps
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  delivered_at      DateTime?
  cancelled_at      DateTime?
  
  // Rela√ß√µes
  couponUsage       CouponUsage[]
  affiliateClicks   AffiliateClick[]
  affiliateCommissions AffiliateCommission[]
  
  @@index([user_email])
  @@index([status])
  @@index([order_number])
  @@index([created_at])
  @@map("orders")
}

// ============================================
// 3Ô∏è‚É£ REVIEWS (Avalia√ß√µes)
// ============================================
model Review {
  id                      String    @id @default(uuid())
  product_id              String    @db.VarChar(191)
  
  // Informa√ß√µes do Usu√°rio
  user_id                 String?   @db.VarChar(191)
  user_name               String    @db.VarChar(200)
  user_email              String    @db.VarChar(200)
  
  // Avalia√ß√£o
  rating                  Int       // 1-5
  comment                 String?   @db.Text
  
  // M√≠dia (fotos e v√≠deos)
  images                  Json?     // Array de URLs de imagens
  videos                  Json?     // Array de URLs de v√≠deos
  
  // Intera√ß√£o
  helpful_count           Int       @default(0)
  not_helpful_count       Int       @default(0)
  
  // Status
  is_approved             Boolean   @default(false)
  is_verified_purchase    Boolean   @default(false)
  status                  String    @default("pending") @db.VarChar(50)
  
  // Timestamps
  created_at              DateTime  @default(now())
  updated_at              DateTime  @updatedAt
  
  // Rela√ß√£o
  product                 Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  @@index([product_id])
  @@index([user_email])
  @@index([status])
  @@map("reviews")
}

// ============================================
// 4Ô∏è‚É£ COUPONS (Cupons de Desconto)
// ============================================
model Coupon {
  id                    String        @id @default(uuid())
  code                  String        @unique @db.VarChar(50)
  description           String?       @db.Text
  
  // Tipo de Desconto
  discount_type         String        @db.VarChar(50) // 'percentage' ou 'fixed'
  discount_value        Decimal       @db.Decimal(12, 2)
  max_discount          Decimal?      @db.Decimal(12, 2)
  
  // Filtros Avan√ßados
  category_id           String?       @db.VarChar(100) // Cupom espec√≠fico para categoria
  first_purchase_only   Boolean       @default(false) // Apenas primeira compra
  user_specific         String?       @db.VarChar(200) // Email do usu√°rio (cupom √∫nico)
  
  // Condi√ß√µes
  minimum_order_value   Decimal?      @db.Decimal(12, 2) @default(0)
  usage_limit           Int?
  used_count            Int           @default(0)
  
  // Status
  is_active             Boolean       @default(true)
  
  // Validade
  valid_from            DateTime      @default(now())
  valid_until           DateTime?
  
  // Timestamps
  created_at            DateTime      @default(now())
  updated_at            DateTime      @updatedAt
  
  // Rela√ß√µes
  category              Category?     @relation(fields: [category_id], references: [id], onDelete: SetNull)
  usage_history         CouponUsage[]
  
  @@index([code])
  @@index([is_active])
  @@index([valid_until])
  @@index([category_id])
  @@map("coupons")
}

// ============================================
// 4.1Ô∏è‚É£ COUPON_USAGE (Hist√≥rico de Uso de Cupons)
// ============================================
model CouponUsage {
  id                String    @id @default(uuid())
  coupon_id         String    @db.VarChar(100)
  
  // Usu√°rio
  user_id           String?   @db.VarChar(100)
  user_email        String    @db.VarChar(200)
  user_name         String?   @db.VarChar(200)
  
  // Pedido
  order_id          String?   @db.VarChar(100)
  order_total       Decimal   @db.Decimal(12, 2)
  discount_amount   Decimal   @db.Decimal(12, 2)
  
  // Timestamps
  created_at        DateTime  @default(now())
  
  // Rela√ß√£o
  coupon            Coupon    @relation(fields: [coupon_id], references: [id], onDelete: Cascade)
  order             Order?    @relation(fields: [order_id], references: [id], onDelete: SetNull)
  
  @@index([coupon_id])
  @@index([user_email])
  @@index([order_id])
  @@map("coupon_usage")
}

// ============================================
// 5Ô∏è‚É£ AFFILIATES (Sistema de Afiliados)
// ============================================
model Affiliate {
  id                    String              @id @default(uuid())
  
  // Usu√°rio Afiliado
  user_id               String?             @db.VarChar(100)
  name                  String              @db.VarChar(200)
  email                 String              @unique @db.VarChar(200)
  phone                 String?             @db.VarChar(50)
  
  // C√≥digo de Afiliado
  affiliate_code        String              @unique @db.VarChar(50)
  
  // Comiss√£o
  commission_rate       Decimal             @db.Decimal(5, 2) // Percentual (ex: 5.00 = 5%)
  
  // Estat√≠sticas
  total_clicks          Int                 @default(0)
  total_sales           Decimal             @default(0) @db.Decimal(12, 2)
  total_commission      Decimal             @default(0) @db.Decimal(12, 2)
  pending_commission    Decimal             @default(0) @db.Decimal(12, 2)
  paid_commission       Decimal             @default(0) @db.Decimal(12, 2)
  
  // Dados Banc√°rios (para pagamento)
  bank_name             String?             @db.VarChar(100)
  account_holder        String?             @db.VarChar(200)
  account_number        String?             @db.VarChar(100)
  iban                  String?             @db.VarChar(100)
  
  // Status
  status                String              @default("active") @db.VarChar(50) // active, suspended, inactive
  is_active             Boolean             @default(true)
  
  // Timestamps
  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt
  
  // Rela√ß√µes
  clicks                AffiliateClick[]
  commissions           AffiliateCommission[]
  
  @@index([affiliate_code])
  @@index([email])
  @@index([status])
  @@map("affiliates")
}

// ============================================
// 5.1Ô∏è‚É£ AFFILIATE_CLICKS (Cliques de Afiliados)
// ============================================
model AffiliateClick {
  id                String    @id @default(uuid())
  affiliate_id      String    @db.VarChar(100)
  
  // Produto clicado
  product_id        String?   @db.VarChar(100)
  product_name      String?   @db.VarChar(255)
  
  // Informa√ß√µes do visitante
  ip_address        String?   @db.VarChar(100)
  user_agent        String?   @db.Text
  referrer          String?   @db.VarChar(500)
  
  // Converteu em venda?
  converted         Boolean   @default(false)
  order_id          String?   @db.VarChar(100)
  
  // Timestamp
  created_at        DateTime  @default(now())
  
  // Rela√ß√µes
  affiliate         Affiliate @relation(fields: [affiliate_id], references: [id], onDelete: Cascade)
  product           Product?  @relation(fields: [product_id], references: [id], onDelete: SetNull)
  order             Order?    @relation(fields: [order_id], references: [id], onDelete: SetNull)
  
  @@index([affiliate_id])
  @@index([product_id])
  @@index([created_at])
  @@index([converted])
  @@map("affiliate_clicks")
}

// ============================================
// 5.2Ô∏è‚É£ AFFILIATE_COMMISSIONS (Comiss√µes de Afiliados)
// ============================================
model AffiliateCommission {
  id                String    @id @default(uuid())
  affiliate_id      String    @db.VarChar(100)
  
  // Pedido relacionado
  order_id          String    @db.VarChar(100)
  order_total       Decimal   @db.Decimal(12, 2)
  
  // Comiss√£o
  commission_rate   Decimal   @db.Decimal(5, 2)
  commission_amount Decimal   @db.Decimal(12, 2)
  
  // Status
  status            String    @default("pending") @db.VarChar(50) // pending, approved, paid, cancelled
  
  // Pagamento
  paid_at           DateTime?
  payment_method    String?   @db.VarChar(100)
  payment_reference String?   @db.VarChar(255)
  payment_notes     String?   @db.Text
  
  // Timestamps
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  
  // Rela√ß√µes
  affiliate         Affiliate @relation(fields: [affiliate_id], references: [id], onDelete: Cascade)
  order             Order     @relation(fields: [order_id], references: [id], onDelete: Cascade)
  
  @@index([affiliate_id])
  @@index([order_id])
  @@index([status])
  @@map("affiliate_commissions")
}

// ============================================
// 6Ô∏è‚É£ PRICE_ALERTS (Alertas de Pre√ßo)
// ============================================
model PriceAlert {
  id                String    @id @default(uuid())
  product_id        String    @db.VarChar(100)
  
  // Usu√°rio
  user_name         String    @db.VarChar(200)
  user_email        String    @db.VarChar(200)
  
  // Alerta
  target_price      Decimal   @db.Decimal(12, 2)
  notified          Boolean   @default(false)
  notified_at       DateTime?
  
  // Timestamps
  created_at        DateTime  @default(now())
  
  // Rela√ß√£o
  product           Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  @@index([product_id])
  @@index([user_email])
  @@map("price_alerts")
}

// ============================================
// 6Ô∏è‚É£ PRE_ORDERS (Pr√©-vendas)
// ============================================
model PreOrder {
  id                  String    @id @default(uuid())
  
  // Usu√°rio
  user_id             String?   @db.VarChar(100)
  user_email          String    @db.VarChar(200)
  user_name           String    @db.VarChar(200)
  
  // Produto
  product_id          String    @db.VarChar(100)
  product_name        String    @db.VarChar(255)
  quantity            Int       @default(1)
  price               Decimal   @db.Decimal(12, 2)
  total               Decimal   @db.Decimal(12, 2)
  
  // Detalhes da Pr√©-venda
  estimated_delivery  String?   @db.VarChar(100)
  status              String    @default("pending") @db.VarChar(50) // pending, confirmed, arrived, delivered, cancelled
  payment_status      String    @default("pending") @db.VarChar(50) // pending, partial, paid
  paid_amount         Decimal   @default(0) @db.Decimal(12, 2)
  payment_proof       String?   @db.VarChar(500) // URL do comprovante
  notes               String?   @db.Text
  
  // Timestamps
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  
  // Rela√ß√£o
  product             Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  @@index([product_id])
  @@index([user_email])
  @@index([status])
  @@map("pre_orders")
}

// ============================================
// 7Ô∏è‚É£ FLASH_SALES (Vendas Rel√¢mpago)
// ============================================
model FlashSale {
  id                    String    @id @default(uuid())
  product_id            String    @db.VarChar(100)
  
  // Detalhes da Flash Sale
  title                 String    @db.VarChar(255)
  description           String?   @db.Text
  product_name          String?   @db.VarChar(255)
  
  // Pre√ßos
  original_price        Decimal?  @db.Decimal(12, 2)
  sale_price            Decimal?  @db.Decimal(12, 2)
  discount_percentage   Decimal   @db.Decimal(5, 2)
  
  // Estoque Limitado
  stock_limit           Int
  stock_sold            Int       @default(0)
  
  // Per√≠odo
  start_date            DateTime
  end_date              DateTime
  
  // Status
  is_active             Boolean   @default(true)
  
  // Timestamps
  created_at            DateTime  @default(now())
  updated_at            DateTime  @updatedAt
  
  // Rela√ß√£o
  product               Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  @@index([product_id])
  @@index([is_active])
  @@index([start_date])
  @@index([end_date])
  @@map("flash_sales")
}

// ============================================
// 7Ô∏è‚É£ CUSTOMER_PROFILES (Perfis de Clientes)
// ============================================
model CustomerProfile {
  id                String    @id @default(uuid())
  auth_user_id      String?   @unique @db.VarChar(100)

  // Informa√ß√µes Pessoais
  nome              String    @db.VarChar(200)
  email             String    @unique @db.VarChar(200)
  telefone          String?   @db.VarChar(50)
  password          String?   @db.VarChar(255) // Senha hash (bcrypt)

  // Endere√ßo (JSON)
  endereco          Json?

  // Prefer√™ncias
  preferences       Json?

  // Admin e Status
  is_admin          Boolean   @default(false)
  is_active         Boolean   @default(true)
  role              String    @default("customer") @db.VarChar(50) // 'admin' ou 'customer'

  // Timestamps
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  @@index([email])
  @@index([is_admin])
  @@index([is_active])
  @@map("customer_profiles")
}

// ============================================
// 8Ô∏è‚É£ LOYALTY_ACCOUNTS (Contas de Fidelidade)
// ============================================
model LoyaltyAccount {
  id                String    @id @default(uuid())
  user_email        String    @unique @db.VarChar(200)
  user_name         String    @db.VarChar(200)
  
  // Pontos
  points            Int       @default(0)
  lifetime_points   Int       @default(0)
  
  // N√≠vel
  tier              String?   @db.VarChar(50) // 'bronze', 'silver', 'gold', 'platinum'
  
  // Timestamps
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  
  // Rela√ß√£o
  history           LoyaltyHistory[]
  
  @@index([user_email])
  @@map("loyalty_accounts")
}

// ============================================
// 9Ô∏è‚É£ LOYALTY_HISTORY (Hist√≥rico de Fidelidade)
// ============================================
model LoyaltyHistory {
  id                String    @id @default(uuid())
  user_email        String    @db.VarChar(200)
  
  // Tipo de Transa√ß√£o
  type              String    @db.VarChar(50) // 'earn', 'redeem', 'expire'
  points            Int
  description       String?   @db.Text
  
  // Refer√™ncia ao Pedido
  order_id          String?   @db.VarChar(100)
  
  // Timestamps
  created_at        DateTime  @default(now())
  
  // Rela√ß√£o
  account           LoyaltyAccount @relation(fields: [user_email], references: [user_email], onDelete: Cascade)
  
  @@index([user_email])
  @@index([created_at])
  @@map("loyalty_history")
}

// ============================================
// 10Ô∏è‚É£ WHATSAPP MESSAGES (Logs de Mensagens)
// ============================================
model WhatsAppMessage {
  id            String    @id @default(uuid())
  message_sid   String?   @db.VarChar(100)
  to            String    @db.VarChar(50)
  from          String    @db.VarChar(50)
  template_sid  String?   @db.VarChar(100)
  body          String?   @db.Text
  status        String?   @db.VarChar(50)
  error_code    Int?
  error_message String?   @db.Text
  metadata      Json?
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  @@index([to])
  @@index([message_sid])
  @@map("whatsapp_messages")
}

// ============================================
// üîü STOCK_HISTORY (Hist√≥rico de Estoque)
// ============================================
model StockHistory {
  id                String    @id @default(uuid())
  product_id        String    @db.VarChar(100)
  product_name      String    @db.VarChar(255)
  
  // Mudan√ßa de Estoque
  old_stock         Int
  new_stock         Int
  change_amount     Int
  
  // Raz√£o
  reason            String?   @db.VarChar(255)
  order_id          String?   @db.VarChar(100)
  created_by        String?   @db.VarChar(200)
  
  // Timestamps
  created_at        DateTime  @default(now())
  
  // Rela√ß√£o
  product           Product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  @@index([product_id])
  @@index([created_at])
  @@map("stock_history")
}

// ============================================
// 1Ô∏è‚É£1Ô∏è‚É£ ANALYTICS_EVENTS (Eventos de Analytics)
// ============================================
model AnalyticsEvent {
  id                String    @id @default(uuid())
  
  // Tipo de Evento
  event_type        String    @db.VarChar(100)
  event_category    String?   @db.VarChar(100)
  
  // Sess√£o
  session_id        String    @db.VarChar(200)
  user_email        String?   @db.VarChar(200)
  
  // P√°gina
  page_url          String?   @db.VarChar(500)
  page_title        String?   @db.VarChar(255)
  referrer          String?   @db.VarChar(500)
  
  // Produto
  product_id        String?   @db.VarChar(100)
  product_name      String?   @db.VarChar(255)
  product_price     Decimal?  @db.Decimal(12, 2)
  
  // Pedido
  order_id          String?   @db.VarChar(100)
  order_value       Decimal?  @db.Decimal(12, 2)
  
  // Carrinho
  cart_value        Decimal?  @db.Decimal(12, 2)
  
  // Busca
  search_query      String?   @db.VarChar(255)
  
  // Dispositivo e Navegador
  device_type       String?   @db.VarChar(50)
  browser           String?   @db.VarChar(100)
  os                String?   @db.VarChar(100)
  user_agent        String?   @db.VarChar(500)
  
  // Localiza√ß√£o
  ip_address        String?   @db.VarChar(50)
  country           String?   @db.VarChar(100)
  city              String?   @db.VarChar(100)
  
  // Metadados Adicionais
  metadata          Json?
  
  // Timestamps
  created_at        DateTime  @default(now())
  
  @@index([event_type])
  @@index([session_id])
  @@index([user_email])
  @@index([created_at])
  @@map("analytics_events")
}

// ============================================
// 12Ô∏è‚É£ CATEGORIES (Categorias)
// ============================================
model Category {
  id            String        @id @default(uuid())
  name          String        @db.VarChar(200)
  slug          String        @unique @db.VarChar(200)
  description   String?       @db.Text
  icon          String?       @db.VarChar(200)
  image_url     String?       @db.VarChar(500)
  parent_id     String?       @db.VarChar(100)
  order         Int           @default(0)
  active        Boolean       @default(true)
  
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  
  subcategories Subcategory[]
  coupons       Coupon[]
  
  @@index([slug])
  @@index([active])
  @@map("categories")
}

// ============================================
// 13Ô∏è‚É£ SUBCATEGORIES (Subcategorias)
// ============================================
model Subcategory {
  id            String    @id @default(uuid())
  category_id   String    @db.VarChar(100)
  name          String    @db.VarChar(200)
  slug          String    @unique @db.VarChar(200)
  description   String?   @db.Text
  // icon          String?   @db.VarChar(200)  // Removido temporariamente - n√£o existe no banco de produ√ß√£o
  order         Int       @default(0)
  active        Boolean   @default(true)

  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  category      Category  @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@index([category_id])
  @@index([slug])
  @@index([active])
  @@map("subcategories")
}

// ============================================
// 14Ô∏è‚É£ ADVERTISEMENTS (An√∫ncios/Banners)
// ============================================
model Advertisement {
  id               String    @id @default(uuid())
  
  // Conte√∫do
  titulo           String    @db.VarChar(255)
  descricao        String?   @db.Text
  imagem_url_v2    String    @db.Text  @map("imagem_url_v2") // Text para suportar imagens base64 grandes
  link_url         String?   @db.VarChar(500)
  
  // Configura√ß√£o
  posicao          String    @db.VarChar(50) // home-hero-banner, home-sidebar, etc
  tipo             String    @default("banner") @db.VarChar(50) // banner, card, sidebar, popup
  ativo            Boolean   @default(true)
  
  // Per√≠odo
  data_inicio      DateTime
  data_fim         DateTime?
  
  // M√©tricas
  cliques          Int       @default(0)
  visualizacoes    Int       @default(0)
  
  // Metadados
  criado_por       String    @db.VarChar(200)
  criado_em        DateTime  @default(now())
  atualizado_em    DateTime  @updatedAt
  
  @@index([posicao])
  @@index([ativo])
  @@index([data_inicio, data_fim])
  @@map("advertisements")
}

model Ticket {
  id               String   @id @default(uuid())
  ticket_number    String   @unique
  user_id          String
  user_name        String
  user_email       String
  subject          String
  category         String   // suporte, pedido, produto, pagamento, outros
  priority         String   @default("normal") // baixa, normal, alta, urgente
  status           String   @default("open") // open, in_progress, resolved, closed
  description      String   @db.Text
  messages         Json     @default("[]") // Array de mensagens
  attachments      Json     @default("[]") // Array de arquivos anexados
  assigned_to      String?  // ID do admin respons√°vel
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  resolved_at      DateTime?
  closed_at        DateTime?
  
  @@index([user_id])
  @@index([status])
  @@index([category])
  @@index([priority])
  @@map("tickets")
}

// ============================================
// 17.5Ô∏è‚É£ QUOTES (Or√ßamentos Personalizados)
// ============================================
model Quote {
  id                  String   @id @default(uuid())
  quote_number        String   @unique
  user_id             String?
  user_name           String
  user_email          String
  user_phone          String
  company             String?
  
  // Requisitos do Cliente
  requirements        String   @db.Text // Descri√ß√£o detalhada
  budget              Decimal? @db.Decimal(12, 2) // Or√ßamento dispon√≠vel
  
  // Status e Acompanhamento
  status              String   @default("pending") // pending, in_progress, sent, accepted, rejected
  priority            String   @default("normal") // low, normal, high
  
  // Proposta do Admin
  admin_proposal      String?  @db.Text
  proposed_items      Json?    // Array de {name, quantity, unit_price, subtotal}
  total_amount        Decimal? @db.Decimal(12, 2)
  admin_notes         String?  @db.Text
  
  // Metadados
  assigned_to         String?  // ID do admin respons√°vel
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  responded_at        DateTime?
  accepted_at         DateTime?
  rejected_at         DateTime?
  
  @@index([user_id])
  @@index([user_email])
  @@index([status])
  @@index([created_at])
  @@map("quotes")
}

// ============================================
// 18Ô∏è‚É£ USERS (Usu√°rios - Admin e Team)
// ============================================
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password_hash     String   // Hash bcrypt da senha
  name              String
  user_type         String   @default("team") // admin, team
  is_active         Boolean  @default(true)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  last_login        DateTime?
  
  // Rela√ß√£o com TeamMember
  team_member       TeamMember? @relation(fields: [team_member_id], references: [id])
  team_member_id    String?     @unique
  
  @@index([email])
  @@index([user_type])
  @@index([is_active])
  @@map("users")
}

// ============================================
// 19Ô∏è‚É£ TEAM MEMBERS (Membros da Equipe)
// ============================================
model TeamMember {
  id                String   @id @default(uuid())
  email             String   @unique
  name              String
  role              String   // admin, editor, viewer, moderator
  permissions       Json     // Permiss√µes espec√≠ficas
  is_active         Boolean  @default(true)
  invited_by        String   // ID do admin que convidou
  invited_at        DateTime @default(now())
  accepted_at       DateTime?
  last_login        DateTime?
  avatar_url        String?
  department        String?  // vendas, estoque, marketing, suporte
  phone             String?
  temp_password     String?  // Senha tempor√°ria (removida ap√≥s primeiro login)
  password_changed  Boolean  @default(false)
  
  // Rela√ß√£o com User
  user              User?
  
  @@index([email])
  @@index([role])
  @@index([is_active])
  @@map("team_members")
}

// ============================================
// 20Ô∏è‚É£ PENDING ACTIONS (A√ß√µes Pendentes de Aprova√ß√£o)
// ============================================
model PendingAction {
  id                String   @id @default(uuid())
  action_type       String   // create_product, update_product, delete_product, create_coupon, etc
  entity_type       String   // product, coupon, flash_sale, order, etc
  entity_id         String?  // ID da entidade afetada (null para cria√ß√£o)
  action_data       Json     // Dados da a√ß√£o (novo produto, altera√ß√µes, etc)
  original_data     Json?    // Dados originais antes da altera√ß√£o
  requested_by      String   // ID do membro da equipe
  requested_by_name String
  requested_at      DateTime @default(now())
  status            String   @default("pending") // pending, approved, rejected
  reviewed_by       String?  // ID do admin que revisou
  reviewed_by_name  String?
  reviewed_at       DateTime?
  review_notes      String?  @db.Text
  priority          String   @default("normal") // low, normal, high, urgent
  
  @@index([status])
  @@index([requested_by])
  @@index([action_type])
  @@index([entity_type])
  @@map("pending_actions")
}

// ============================================
// 21Ô∏è‚É£ ACTIVITY LOG (Log de Atividades)
// ============================================
model ActivityLog {
  id                String   @id @default(uuid())
  user_id           String
  user_name         String
  user_role         String
  action_type       String   // login, logout, create, update, delete, approve, reject
  entity_type       String?  // product, order, coupon, etc
  entity_id         String?
  description       String   @db.Text
  metadata          Json?    // Dados adicionais da a√ß√£o
  ip_address        String?
  user_agent        String?  @db.Text
  created_at        DateTime @default(now())
  
  @@index([user_id])
  @@index([action_type])
  @@index([created_at])
  @@map("activity_logs")
}

// ============================================
// 22Ô∏è‚É£ BLOG POSTS (Artigos do Blog)
// ============================================
model BlogPost {
  id                String    @id @default(uuid())
  
  // Conte√∫do
  title             String    @db.VarChar(255)
  slug              String    @unique @db.VarChar(255)
  excerpt           String?   @db.Text // Resumo/descri√ß√£o curta
  content           String    @db.Text // Conte√∫do completo (suporta HTML/Markdown)
  
  // Imagens
  cover_image       String?   @db.VarChar(500) // Imagem de capa
  images            Json?     // Array de imagens adicionais
  
  // Categoriza√ß√£o
  category          String?   @db.VarChar(100) // Hardware, Armazenamento, Seguran√ßa, etc
  tags              Json?     // Array de tags
  
  // Autor
  author_id         String    @db.VarChar(100)
  author_name       String    @db.VarChar(200)
  author_email      String    @db.VarChar(200)
  
  // SEO
  meta_title        String?   @db.VarChar(255)
  meta_description  String?   @db.VarChar(500)
  meta_keywords     Json?     // Array de palavras-chave
  
  // Status e Publica√ß√£o
  status            String    @default("draft") @db.VarChar(50) // draft, published, archived
  is_featured       Boolean   @default(false) // Destaque na homepage
  published_at      DateTime?
  
  // Estat√≠sticas
  views_count       Int       @default(0)
  likes_count       Int       @default(0)
  
  // Timestamps
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  
  @@index([slug])
  @@index([status])
  @@index([category])
  @@index([author_id])
  @@index([published_at])
  @@index([is_featured])
  @@map("blog_posts")
}

// ============================================
// 23Ô∏è‚É£ NEWSLETTER SUBSCRIBERS (Inscritos na Newsletter)
// ============================================
model NewsletterSubscriber {
  id                String    @id @default(uuid())
  email             String    @unique @db.VarChar(255)
  name              String?   @db.VarChar(200)
  status            String    @default("active") @db.VarChar(50) // active, unsubscribed, bounced
  source            String?   @db.VarChar(100) // footer, blog, popup, checkout
  subscribed_at     DateTime  @default(now())
  unsubscribed_at   DateTime?
  
  @@index([email])
  @@index([status])
  @@index([subscribed_at])
  @@map("NewsletterSubscriber")
}

// ============================================
// 24Ô∏è‚É£ LOW STOCK ALERTS (Alertas de Stock Baixo)
// ============================================
model LowStockAlert {
  id              String    @id @default(uuid())
  product_id      String
  product_name    String    @db.VarChar(255)
  current_stock   Int
  minimum_stock   Int
  threshold_level Int       // N√≠vel que disparou o alerta
  status          String    @default("pending") @db.VarChar(50) // pending, resolved, ignored
  notified_at     DateTime  @default(now())
  resolved_at     DateTime?
  notes           String?   @db.Text
  
  @@index([product_id])
  @@index([status])
  @@index([notified_at])
  @@map("low_stock_alerts")
}

// ============================================
// 25Ô∏è‚É£ ABANDONED CARTS (Carrinhos Abandonados)
// ============================================
model AbandonedCart {
  id                String    @id @default(uuid())
  user_id           String?   // Pode ser null para guests
  user_email        String    @db.VarChar(255)
  user_name         String?   @db.VarChar(200)
  cart_items        Json      // Array de itens do carrinho
  cart_total        Decimal   @db.Decimal(12, 2)
  currency          String    @default("AOA") @db.VarChar(10)
  
  // Tracking
  created_at        DateTime  @default(now())
  abandoned_at      DateTime  // Quando foi considerado abandonado (>30min sem atividade)
  last_reminder_at  DateTime? // √öltimo email de recupera√ß√£o enviado
  reminder_count    Int       @default(0) // Quantos emails foram enviados
  
  // Status
  status            String    @default("abandoned") @db.VarChar(50) // abandoned, recovered, expired
  recovered_at      DateTime? // Se o carrinho foi recuperado (pedido criado)
  recovered_order_id String?  // ID do pedido criado (se recuperado)
  
  // Recovery
  recovery_token    String?   @unique @db.VarChar(255) // Token √∫nico para link de recupera√ß√£o
  recovery_discount Float?    // Desconto oferecido para recupera√ß√£o (%)
  
  @@index([user_email])
  @@index([status])
  @@index([abandoned_at])
  @@index([recovery_token])
  @@map("abandoned_carts")
}

// ============================================
// 26Ô∏è‚É£ EMAIL CAMPAIGNS (Campanhas de Email)
// ============================================
model EmailCampaign {
  id              String    @id @default(uuid())
  name            String    @db.VarChar(255)
  subject         String    @db.VarChar(500)
  content_html    String    @db.Text
  content_text    String?   @db.Text
  
  // Segmentation
  target_audience String    @db.VarChar(100) // all, customers, newsletter, abandoned_carts
  segment_filter  Json?     // Filtros adicionais
  
  // Scheduling
  status          String    @default("draft") @db.VarChar(50) // draft, scheduled, sending, sent, failed
  scheduled_for   DateTime?
  sent_at         DateTime?
  
  // Stats
  total_recipients Int      @default(0)
  total_sent      Int       @default(0)
  total_opened    Int       @default(0)
  total_clicked   Int       @default(0)
  total_bounced   Int       @default(0)
  total_unsubscribed Int    @default(0)
  
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  created_by      String?   // Admin user ID
  
  @@index([status])
  @@index([scheduled_for])
  @@map("email_campaigns")
}

// ============================================
// 27Ô∏è‚É£ ANALYTICS METRICS (M√©tricas de Analytics)
// ============================================
model AnalyticsMetric {
  id              String    @id @default(uuid())
  metric_type     String    @db.VarChar(100) // clv, conversion_rate, revenue, orders, etc
  metric_value    Decimal   @db.Decimal(12, 2)
  metric_unit     String?   @db.VarChar(50) // AOA, USD, %, count
  
  // Dimensions
  date            DateTime  // Data da m√©trica
  period_type     String    @db.VarChar(50) // daily, weekly, monthly, yearly
  
  // Segmentation
  segment_type    String?   @db.VarChar(100) // customer_type, product_category, source
  segment_value   String?   @db.VarChar(255)
  
  // Metadata
  calculated_at   DateTime  @default(now())
  metadata        Json?     // Dados adicionais
  
  @@index([metric_type, date])
  @@index([date])
  @@index([period_type])
  @@map("analytics_metrics")
}

