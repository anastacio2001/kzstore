#!/bin/bash

# InstruÃ§Ãµes para Configurar OAuth com kzstore.ao
# Data: 9 Dezembro 2025

echo "ğŸ” ConfiguraÃ§Ã£o OAuth - Google & Facebook"
echo "=========================================="
echo ""

# Cores
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}ğŸ“‹ URLs de Callback Atualizadas:${NC}"
echo ""
echo "DomÃ­nio: https://kzstore.ao"
echo "Backend: https://kzstore-backend.fly.dev"
echo ""

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}1ï¸âƒ£ GOOGLE OAUTH CONFIGURATION${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "Acesse: https://console.cloud.google.com/apis/credentials"
echo ""
echo "âœ… Authorized JavaScript origins:"
echo "   â€¢ https://kzstore.ao"
echo "   â€¢ https://kzstore-backend.fly.dev"
echo ""
echo "âœ… Authorized redirect URIs:"
echo "   â€¢ https://kzstore-backend.fly.dev/api/auth/google/callback"
echo "   â€¢ https://kzstore.ao/api/auth/google/callback"
echo ""
echo -e "${YELLOW}Passo a passo:${NC}"
echo "1. Selecione seu projeto Google Cloud"
echo "2. VÃ¡ em: APIs & Services â†’ Credentials"
echo "3. Clique no OAuth 2.0 Client ID criado"
echo "4. Em 'Authorized JavaScript origins', adicione:"
echo "   - https://kzstore.ao"
echo "   - https://kzstore-backend.fly.dev"
echo "5. Em 'Authorized redirect URIs', adicione:"
echo "   - https://kzstore-backend.fly.dev/api/auth/google/callback"
echo "6. Clique em 'Save'"
echo ""

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}2ï¸âƒ£ FACEBOOK OAUTH CONFIGURATION${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "Acesse: https://developers.facebook.com/apps"
echo ""
echo "âœ… Valid OAuth Redirect URIs:"
echo "   â€¢ https://kzstore-backend.fly.dev/api/auth/facebook/callback"
echo "   â€¢ https://kzstore.ao/api/auth/facebook/callback"
echo ""
echo "âœ… App Domains:"
echo "   â€¢ kzstore.ao"
echo "   â€¢ kzstore-backend.fly.dev"
echo ""
echo -e "${YELLOW}Passo a passo:${NC}"
echo "1. Selecione seu app Facebook"
echo "2. VÃ¡ em: Settings â†’ Basic"
echo "3. Em 'App Domains', adicione:"
echo "   - kzstore.ao"
echo "   - kzstore-backend.fly.dev"
echo "4. VÃ¡ em: Products â†’ Facebook Login â†’ Settings"
echo "5. Em 'Valid OAuth Redirect URIs', adicione:"
echo "   - https://kzstore-backend.fly.dev/api/auth/facebook/callback"
echo "6. Clique em 'Save Changes'"
echo ""

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}3ï¸âƒ£ VERIFICAR CONFIGURAÃ‡Ã•ES ATUAIS${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "VariÃ¡veis de ambiente configuradas no Fly.io:"
echo ""

fly secrets list -a kzstore-backend 2>&1 | grep -E "NAME|VITE_APP_URL|GOOGLE|FACEBOOK"

echo ""
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}4ï¸âƒ£ TESTAR OAUTH${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "ğŸ§ª Teste de Login:"
echo ""
echo "1. Acesse: https://kzstore.ao"
echo "2. Clique em 'Entrar' ou 'Cadastrar'"
echo "3. Escolha 'Continuar com Google' ou 'Continuar com Facebook'"
echo "4. VocÃª deve ser redirecionado para:"
echo "   - PÃ¡gina de autorizaÃ§Ã£o Google/Facebook"
echo "   - ApÃ³s aprovar, volta para: https://kzstore.ao"
echo "   - Mensagem: 'Login realizado com sucesso! Bem-vindo(a)!'"
echo ""
echo -e "${YELLOW}Se der erro:${NC}"
echo "â€¢ Verifique o console do navegador (F12)"
echo "â€¢ Veja se a URL de callback estÃ¡ correta"
echo "â€¢ Confirme que adicionou as URLs no Google/Facebook"
echo ""

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}5ï¸âƒ£ LOGS DE DEBUG${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "Ver logs do backend em tempo real:"
echo ""
echo -e "${YELLOW}fly logs -a kzstore-backend${NC}"
echo ""
echo "Procure por:"
echo "â€¢ ğŸ”µ [OAuth Google] ..."
echo "â€¢ ğŸ”µ [OAuth Facebook] ..."
echo "â€¢ âœ… [OAuth] Token recebido..."
echo "â€¢ âŒ [OAuth] Erro..."
echo ""

echo -e "${GREEN}âœ¨ ConfiguraÃ§Ã£o completa!${NC}"
echo ""
echo "PrÃ³ximos passos:"
echo "1. Configure URLs no Google Cloud Console"
echo "2. Configure URLs no Facebook Developers"
echo "3. Teste o login em https://kzstore.ao"
echo "4. Verifique logs com: fly logs -a kzstore-backend"
